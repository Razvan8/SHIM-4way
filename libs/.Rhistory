phi[i,k,j,l]<-phi_vec[counter]/24
phi[i,k,l,j]<-phi_vec[counter]/24
phi[i,l,j,k]<-phi_vec[counter]/24
phi[i,l,k,j]<-phi_vec[counter]/24
phi[j,i,k,l]<-phi_vec[counter]/24
phi[j,i,l,k]<-phi_vec[counter]/24
phi[j,k,i,l]<-phi_vec[counter]/24
phi[j,k,l,i]<-phi_vec[counter]/24
phi[j,l,i,k]<-phi_vec[counter]/24
phi[j,l,k,i]<-phi_vec[counter]/24
phi[k,i,j,l]<-phi_vec[counter]/24
phi[k,i,l,j]<-phi_vec[counter]/24
phi[k,j,i,l]<-phi_vec[counter]/24
phi[k,j,l,i]<-phi_vec[counter]/24
phi[k,l,i,j]<-phi_vec[counter]/24
phi[k,l,j,i]<-phi_vec[counter]/24
phi[l,i,j,k]<-phi_vec[counter]/24
phi[l,i,k,j]<-phi_vec[counter]/24
phi[l,j,i,k]<-phi_vec[counter]/24
phi[l,j,k,i]<-phi_vec[counter]/24
phi[l,k,i,j]<-phi_vec[counter]/24
phi[l,k,j,i]<-phi_vec[counter]/24
print(phi_vec[counter])
counter<-counter+1
}}} }
assert(counter==1+ l1*l2*l3*l4,"counter error in phi " )
return(phi)
}
x<-get_phi_from_phi_vec4(phi_vec=c(1:24),l1=3,l2=2,l3=4,l4=1)
x
x<-get_phi_from_phi_vec4(phi_vec=24*c(1:24),l1=3,l2=2,l3=4,l4=1)
x<-get_phi_from_phi_vec4(phi_vec=c(1:24),l1=3,l2=2,l3=4,l4=1)
x_vec<-get_phi_vec4(x,l1=3,l2=2,l3=4,l4=1)
x_vec
psi<-get_psi_from_psi_vec4(psi_vec=6*c(1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2),l1=1,l2=2,l3=2,l4=2)
psi_vec<-get_psi_vec4(psi, l1=1,l2=2,l3=2,l4=2)
psi_vec
#get psi table from psi_vec
get_phi_from_phi_vec4<-function(phi_vec,l1=21,l2=14,l3=2,l4=3)
{ range1<-c(1:l1)
range2<-c((l1+1):(l1+l2))
range3<-c((l1+l2+1):(l1+l2+l3))
range4<-c((l1+l2+l3+1):(l1+l2+l3+l4))
counter<-1
phi<-array(0,dim=(c(l1+l2+l3+l4,l1+l2+l3+l4,l1+l2+l3+l4, l1+l2+l3+l4)))
for (i in range1) {
for (j in range2 ) {
for (k in range3) {
for(l in range4){
#cat("i:", i, ", j:", j, ", k:", k ,'\n')
phi[i,j,k,l]<-phi_vec[counter]
phi[i,j,l,k]<-phi_vec[counter]
phi[i,k,j,l]<-phi_vec[counter]
phi[i,k,l,j]<-phi_vec[counter]
phi[i,l,j,k]<-phi_vec[counter]
phi[i,l,k,j]<-phi_vec[counter]
phi[j,i,k,l]<-phi_vec[counter]
phi[j,i,l,k]<-phi_vec[counter]
phi[j,k,i,l]<-phi_vec[counter]
phi[j,k,l,i]<-phi_vec[counter]
phi[j,l,i,k]<-phi_vec[counter]
phi[j,l,k,i]<-phi_vec[counter]
phi[k,i,j,l]<-phi_vec[counter]
phi[k,i,l,j]<-phi_vec[counter]
phi[k,j,i,l]<-phi_vec[counter]
phi[k,j,l,i]<-phi_vec[counter]
phi[k,l,i,j]<-phi_vec[counter]
phi[k,l,j,i]<-phi_vec[counter]
phi[l,i,j,k]<-phi_vec[counter]
phi[l,i,k,j]<-phi_vec[counter]
phi[l,j,i,k]<-phi_vec[counter]
phi[l,j,k,i]<-phi_vec[counter]
phi[l,k,i,j]<-phi_vec[counter]
phi[l,k,j,i]<-phi_vec[counter]
print(phi_vec[counter])
counter<-counter+1
}}} }
assert(counter==1+ l1*l2*l3*l4,"counter error in phi " )
return(phi)
}
x<-get_phi_from_phi_vec4(phi_vec=c(1:24),l1=3,l2=2,l3=4,l4=1)
x_vec<-get_phi_vec4(x,l1=3,l2=2,l3=4,l4=1)
x_vec
x
get_beta_vec_4way4(beta_3way=c(1,2,3,4),l1=1,l2=1,l3=1,l4=1, tau=1, only_beta=FALSE)
get_beta_vec_4way4<-function(beta_3way, tau, l1=21,l2=14,l3=2,l4=3, only_beta=FALSE) ## # beta_2way should be final beta_2way; #only_beta means product of beta_2ways (gamma included) without delta
{beta_vec4way<- array(0, dim = l1*l2*l3*l4 )
counter<-1
range1<-c(1:l1)
range2<-c ( (l1+1): (l1+l2) )
range3<- c( (l1+l2+1): (l1+l2+l3) )
range4 <- c ( (l1+l2+l3+1): (l1+l2+l3+l4) )
#Iterate over possible positions
for (i in range1){ #ab c/d
for (j in range2 ){
for (k in range3 ){
{for (l in range4){
beta_vec4way[counter]<-beta_3way[psi_table_position_to_vector_index4(position_tuple = c(j,k,l),l1=l1,l2=l2,l3=l3,l4=l4)]*
beta_3way[psi_table_position_to_vector_index4(position_tuple = c(i,j,k),l1=l1,l2=l2,l3=l3, l4=l4)]*
beta_3way[psi_table_position_to_vector_index4(position_tuple = c(i,j,l),l1=l1,l2=l2,l3=l3, l4=l4)]*
beta_3way[psi_table_position_to_vector_index4(position_tuple = c(i,k,l),l1=l1,l2=l2,l3=l3, l4=l4)]
counter<-counter+1}}}}}
if (only_beta == FALSE)
{beta_vec4way<-beta_vec4way*tau}
assert(counter==l1*l2*l3*l4 +1)
return(beta_vec3way)
}
get_beta_vec_4way4(beta_3way=c(1,2,3,4),l1=1,l2=1,l3=1,l4=1, tau=1, only_beta=FALSE)
get_beta_vec_4way4<-function(beta_3way, tau, l1=21,l2=14,l3=2,l4=3, only_beta=FALSE) ## # beta_2way should be final beta_2way; #only_beta means product of beta_2ways (gamma included) without delta
{beta_vec4way<- array(0, dim = l1*l2*l3*l4 )
counter<-1
range1<-c(1:l1)
range2<-c ( (l1+1): (l1+l2) )
range3<- c( (l1+l2+1): (l1+l2+l3) )
range4 <- c ( (l1+l2+l3+1): (l1+l2+l3+l4) )
#Iterate over possible positions
for (i in range1){ #ab c/d
for (j in range2 ){
for (k in range3 ){
{for (l in range4){
beta_vec4way[counter]<-beta_3way[psi_table_position_to_vector_index4(position_tuple = c(j,k,l),l1=l1,l2=l2,l3=l3,l4=l4)]*
beta_3way[psi_table_position_to_vector_index4(position_tuple = c(i,j,k),l1=l1,l2=l2,l3=l3, l4=l4)]*
beta_3way[psi_table_position_to_vector_index4(position_tuple = c(i,j,l),l1=l1,l2=l2,l3=l3, l4=l4)]*
beta_3way[psi_table_position_to_vector_index4(position_tuple = c(i,k,l),l1=l1,l2=l2,l3=l3, l4=l4)]
counter<-counter+1}}}}}
if (only_beta == FALSE)
{beta_vec4way<-beta_vec4way*tau}
assert(counter==l1*l2*l3*l4 +1)
return(beta_vec4way)
}
get_beta_vec_4way4(beta_3way=c(1,2,3,4),l1=1,l2=1,l3=1,l4=1, tau=1, only_beta=FALSE)
get_beta_vec_4way4(beta_3way=c(1,2,3,4,5),l1=1,l2=1,l3=1,l4=2, tau=1, only_beta=FALSE)
get_beta_vec_4way4(beta_3way=c(1,2,3,4,5,6,7),l1=1,l2=1,l3=1,l4=2, tau=1, only_beta=FALSE)
get_beta_vec_4way4<-function(beta_3way, tau, l1=21,l2=14,l3=2,l4=3, only_beta=FALSE) ## # beta_2way should be final beta_2way; #only_beta means product of beta_2ways (gamma included) without delta
{ assert(length(beta_3way)==l1*l2*(l3+l4) + l3*l4*(l1+l2))
beta_vec4way<- array(0, dim = l1*l2*l3*l4 )
counter<-1
range1<-c(1:l1)
range2<-c ( (l1+1): (l1+l2) )
range3<- c( (l1+l2+1): (l1+l2+l3) )
range4 <- c ( (l1+l2+l3+1): (l1+l2+l3+l4) )
#Iterate over possible positions
for (i in range1){ #ab c/d
for (j in range2 ){
for (k in range3 ){
{for (l in range4){
beta_vec4way[counter]<-beta_3way[psi_table_position_to_vector_index4(position_tuple = c(j,k,l),l1=l1,l2=l2,l3=l3,l4=l4)]*
beta_3way[psi_table_position_to_vector_index4(position_tuple = c(i,j,k),l1=l1,l2=l2,l3=l3, l4=l4)]*
beta_3way[psi_table_position_to_vector_index4(position_tuple = c(i,j,l),l1=l1,l2=l2,l3=l3, l4=l4)]*
beta_3way[psi_table_position_to_vector_index4(position_tuple = c(i,k,l),l1=l1,l2=l2,l3=l3, l4=l4)]
counter<-counter+1}}}}}
if (only_beta == FALSE)
{beta_vec4way<-beta_vec4way*tau}
assert(counter==l1*l2*l3*l4 +1)
return(beta_vec4way)
}
get_beta_vec_4way4(beta_3way=c(1,2,3,4,5,6,7),l1=1,l2=1,l3=1,l4=2, tau=1, only_beta=FALSE)
get_beta_vec_4way4(beta_3way=c(1,2,3,4,5,6,7,8),l1=1,l2=1,l3=1,l4=2, tau=1, only_beta=FALSE)
get_beta_vec_4way4(beta_3way=c(1,2,3,4,5,6,7),l1=1,l2=1,l3=1,l4=2, tau=1, only_beta=FALSE)
assert <- function(condition, message) {
if (!condition) stop(message)
}
get_beta_vec_4way4<-function(beta_3way, tau, l1=21,l2=14,l3=2,l4=3, only_beta=FALSE) ## # beta_2way should be final beta_2way; #only_beta means product of beta_2ways (gamma included) without delta
{ assert(length(beta_3way)==l1*l2*(l3+l4) + l3*l4*(l1+l2))
beta_vec4way<- array(0, dim = l1*l2*l3*l4 )
counter<-1
range1<-c(1:l1)
range2<-c ( (l1+1): (l1+l2) )
range3<- c( (l1+l2+1): (l1+l2+l3) )
range4 <- c ( (l1+l2+l3+1): (l1+l2+l3+l4) )
#Iterate over possible positions
for (i in range1){ #ab c/d
for (j in range2 ){
for (k in range3 ){
{for (l in range4){
beta_vec4way[counter]<-beta_3way[psi_table_position_to_vector_index4(position_tuple = c(j,k,l),l1=l1,l2=l2,l3=l3,l4=l4)]*
beta_3way[psi_table_position_to_vector_index4(position_tuple = c(i,j,k),l1=l1,l2=l2,l3=l3, l4=l4)]*
beta_3way[psi_table_position_to_vector_index4(position_tuple = c(i,j,l),l1=l1,l2=l2,l3=l3, l4=l4)]*
beta_3way[psi_table_position_to_vector_index4(position_tuple = c(i,k,l),l1=l1,l2=l2,l3=l3, l4=l4)]
counter<-counter+1}}}}}
if (only_beta == FALSE)
{beta_vec4way<-beta_vec4way*tau}
assert(counter==l1*l2*l3*l4 +1)
return(beta_vec4way)
}
get_beta_vec_4way4(beta_3way=c(1,2,3,4,5,6,7),l1=1,l2=1,l3=1,l4=2, tau=1, only_beta=FALSE)
get_beta_vec_4way4(beta_3way=c(1,2,3,4,5,6,7),l1=1,l2=1,l3=1,l4=2, tau=c(1,2), only_beta=FALSE)
get_positions_4way4<-function(ls_positions, l1=21,l2=14,l3=2,l4=3)
{all_positions<-c()
for (tuple in ls_positions)
{pos<-phi_table_position_to_vector_index4(position_tuple = tuple, l1=l1, l2=l2, l3=l3,l4=l4)
#print(pos)
all_positions<-c(all_positions, pos)}
return(all_positions)}
ls_pos<-list(c(1,2,4,7),c(1,3,5,7), c(1,3,6,7),  c(1,3,6,7))
get_positions_4way4(ls_pos, l1=1, l2=2, l3=3,l4=1)
ls_pos<-list(c(1,2,4,7),c(1,2,5,7), c(1,3,5,7),  c(1,3,6,7))
get_positions_4way4(ls_pos, l1=1, l2=2, l3=3,l4=1)
ls_pos<-list(c(1,2,4,7),c(1,2,5,7), c(1,3,5,7),  c(1,3,6,7))
get_positions_4way4(ls_pos, l1=1, l2=2, l3=3,l4=1)
X<-matrix(c(1,2,3,4,5,6,7,8), nrow = 2)
beta_main<-c(1,2,3,4)
X%*%beta_main
X
beta_main
mains_contribution(X, beta_main, l1=1, l2=1, l3=1, l4=1)
libs_path<-file.path("..","libs")
source(file.path(libs_path,"Combinatorics.R"))
libs_path<-file.path("..","libs")
source(file.path(libs_path,"Combinatorics.R"))
libs_path<-file.path("..","libs")
source(file.path(libs_path,"Combinatorics.R"))
libs_path<-file.path("..","libs")
source(file.path(libs_path,"Combinatorics.R"))
libs_path<-file.path("..","libs")
source(file.path(libs_path,"Combinatorics.R"))
source("Combinatorics.R")
source("Combinatorics.R")
source("Combinatorics.R")
source("Combinatorics.R")
mains_contribution<-function(X, beta_main, l1=21,l2=14,l3=2,l4=3)
{ range_main<-unlist(get_ranges4(l1,l2,l3,l4)[1])
mains_contrib<-X[,range_main]%*%beta_main
return(mains_contrib)}
X<-matrix(c(1,2,3,4,5,6,7,8), nrow = 2)
beta_main<-c(1,2,3,4)
X%*%beta_main
mains_contribution(X, beta_main, l1=1, l2=1, l3=1, l4=1)
source("Create_synthetics_datasets.R")
source("Create_synthetic_datasets.R")
X<-dummy.matrix(NF = 4, NL = rep(2, 4))
beta_main<-c(1,2,3,4)
mains_contribution<-function(X, beta_main, l1=21,l2=14,l3=2,l4=3)
{ range_main<-unlist(get_ranges4(l1,l2,l3,l4)[1])
mains_contrib<-X[,range_main]%*%beta_main
return(mains_contrib)}
X
X[,c(1:4)]%*%beta_main
mains_contribution(X, beta_main, l1=1, l2=1, l3=1, l4=1)
X
X<-as.matrix(X)
X
mains_contribution(X, beta_main, l1=1, l2=1, l3=1, l4=1)
X[,c(1:4)]%*%beta_main
mains_contribution(X, beta_main, l1=1, l2=1, l3=1, l4=1)
beta_2way<-get_beta_vec_2way4<-function(beta=beta_main,l1=1,l2=1,l3=1,l4=1, gamma=1, only_beta = FALSE)
beta_2way
beta_2way
beta_2way<-get_beta_vec_2way4(beta=beta_main,l1=1,l2=1,l3=1,l4=1, gamma=1, only_beta = FALSE)
beta_2way
source("Combinatorics.R")
source("Create_synthetic_datasets.R")
X<-dummy.matrix(NF = 4, NL = rep(2, 4))
X<-as.matrix(X)
beta_main<-c(1,2,3,4)
mains_contribution<-function(X, beta_main, l1=21,l2=14,l3=2,l4=3)
{ range_main<-unlist(get_ranges4(l1,l2,l3,l4)[1])
mains_contrib<-X[,range_main]%*%beta_main
return(mains_contrib)}
X[,c(1:4)]%*%beta_main
mains_contribution(X, beta_main, l1=1, l2=1, l3=1, l4=1)
beta_2way<-get_beta_vec_2way4(beta=beta_main,l1=1,l2=1,l3=1,l4=1, gamma=1, only_beta = FALSE)
beta_2way
two_ways_contribution(X,1,beta_2way, l1=,l2=1,l3=1,l4=1)
two_ways_contribution<-function(X, gamma_vec, beta_vec_2way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X, beta vec is only beta
{if (already_multiplied==TRUE)
{gamma_vec<-array(1, dim=length(gamma_vec))}
range_2ways<-unlist(get_ranges4(l1,l2,l3,l4)[2])
#print(dim())
two_ways_contrib<- X[,range_2ways]%*%(beta_vec_2way*gamma_vec) ##last multiplication should be elementwise
return(two_ways_contrib)}
beta_2way<-get_beta_vec_2way4(beta=beta_main,l1=1,l2=1,l3=1,l4=1, gamma=1, only_beta = FALSE)
two_ways_contribution(X,1,beta_2way, l1=,l2=1,l3=1,l4=1)
two_ways_contribution(X,1,beta_2way, l1=1,l2=1,l3=1,l4=1)
X[,c(5:10)]%*%beta_2way
two_ways_contribution(X,1,beta_2way, l1=1,l2=1,l3=1,l4=1)
print(X[11:15]%*%beta_vec_3way)
beta_vec_3way<-get_beta_vec_3way4(beta_2way = beta_2way, delta=1, l1=1,l2=1,l3=1,l4=1)
print(X[,11:15]%*%beta_vec_3way)
X[,11:15]%*%beta_vec_3way
print(X[,11:14]%*%beta_vec_3way)
beta_vec_3way
three_ways_contribution(X, delta_vec=1, beta_vec_3way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
three_ways_contribution<-function(X, delta_vec, beta_vec_3way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{delta_vec<-array(1, dim=length(delta_vec))}
range_3ways<-unlist(get_ranges(l1,l2,l3,l4)[3])
three_ways_contrib<-X[,range_3ways]%*%(beta_vec_3way*delta_vec) ##last multiplication should be elementwise
return(three_ways_contrib)}
beta_vec_3way<-get_beta_vec_3way4(beta_2way = beta_2way, delta=1, l1=1,l2=1,l3=1,l4=1)
print(X[,11:14]%*%beta_vec_3way)
three_ways_contribution(X, delta_vec=1, beta_vec_3way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
three_ways_contribution<-function(X, delta_vec, beta_vec_3way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{delta_vec<-array(1, dim=length(delta_vec))}
range_3ways<-unlist(get_ranges4(l1,l2,l3,l4)[3])
three_ways_contrib<-X[,range_3ways]%*%(beta_vec_3way*delta_vec) ##last multiplication should be elementwise
return(three_ways_contrib)}
beta_vec_3way<-get_beta_vec_3way4(beta_2way = beta_2way, delta=1, l1=1,l2=1,l3=1,l4=1)
print(X[,11:14]%*%beta_vec_3way)
three_ways_contribution(X, delta_vec=1, beta_vec_3way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
three_ways_contribution(X, delta_vec=1, beta_vec_3way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
X[,c(5:10)]%*%beta_2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{delta_vec<-array(1, dim=length(delta_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
four_ways_contrib<-X[,range_4ways]%*%(beta_vec_4way*delta_vec) ##last multiplication should be elementwise
return(three_ways_contrib)}
four_ways_contribution(X, delta_vec=1, beta_vec_3way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{delta_vec<-array(1, dim=length(delta_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
four_ways_contrib<-X[,range_4ways]%*%(beta_vec_4way*delta_vec) ##last multiplication should be elementwise
return(three_ways_contrib)}
four_ways_contribution(X, tau_vec=1, beta_vec_3way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{delta_vec<-array(1, dim=length(delta_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
four_ways_contrib<-X[,range_4ways]%*%(beta_vec_4way*tau_vec) ##last multiplication should be elementwise
return(three_ways_contrib)}
four_ways_contribution(X, tau_vec=1, beta_vec_3way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
beta_vec_4way<-get_beta_vec_4way4(beta_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X, tau_vec=1, beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{delta_vec<-array(1, dim=length(delta_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
print(range_4ways)
four_ways_contrib<-X[,range_4ways]%*%(beta_vec_4way*tau_vec) ##last multiplication should be elementwise
return(three_ways_contrib)}
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X, tau_vec=1, beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
beta_vec_4way
four_ways_contribution(X=X, tau_vec=1, beta_vec_4way=beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{delta_vec<-array(1, dim=length(delta_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
print(range_4ways)
four_ways_contrib<-X[,range_4ways]*(beta_vec_4way*tau_vec) ##last multiplication should be elementwise
return(three_ways_contrib)}
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X=X, tau_vec=1, beta_vec_4way=beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{delta_vec<-array(1, dim=length(delta_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
print(range_4ways)
four_ways_contrib<-X[,range_4ways]%*%(beta_vec_4way*tau_vec) ##last multiplication should be elementwise
return(three_ways_contrib)}
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X=X, tau_vec=1, beta_vec_4way=beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{delta_vec<-array(1, dim=length(delta_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
print(range_4ways)
four_ways_contrib<-X[,range_4ways]%*%(beta_vec_4way*tau_vec) ##last multiplication should be elementwise
print(X[range_4ways])
return(three_ways_contrib)}
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X=X, tau_vec=1, beta_vec_4way=beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{delta_vec<-array(1, dim=length(delta_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
print(range_4ways)
four_ways_contrib<-X[,range_4ways]%*%(beta_vec_4way*tau_vec) ##last multiplication should be elementwise
print(X[,range_4ways])
return(three_ways_contrib)}
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X=X, tau_vec=1, beta_vec_4way=beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{delta_vec<-array(1, dim=length(delta_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
print(range_4ways)
print(X[,range_4ways])
four_ways_contrib<-X[,range_4ways]%*%(beta_vec_4way*tau_vec) ##last multiplication should be elementwise
return(three_ways_contrib)}
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X=X, tau_vec=1, beta_vec_4way=beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{tau_vec<-array(1, dim=length(tau_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
print(range_4ways)
print(X[,range_4ways])
four_ways_contrib<-X[,range_4ways]%*%(beta_vec_4way*tau_vec) ##last multiplication should be elementwise
return(three_ways_contrib)}
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X=X, tau_vec=1, beta_vec_4way=beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{tau_vec<-array(1, dim=length(tau_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
print(range_4ways)
print(X[,range_4ways])
four_ways_contrib<-(X[,range_4ways]%*%beta_vec_4way)*tau_vec ##last multiplication should be elementwise
return(three_ways_contrib)}
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X=X, tau_vec=1, beta_vec_4way=beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
beta_vec_4way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{tau_vec<-array(1, dim=length(tau_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
print(range_4ways)
print(X[,range_4ways])
four_ways_contrib<-(X[,range_4ways]*beta_vec_4way)*tau_vec ##last multiplication should be elementwise
return(three_ways_contrib)}
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X=X, tau_vec=1, beta_vec_4way=beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{tau_vec<-array(1, dim=length(tau_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
print(range_4ways)
print(X[,range_4ways])
four_ways_contrib<-(X[,range_4ways]*beta_vec_4way)*tau_vec ##last multiplication should be elementwise
return(four_ways_contrib)}
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X=X, tau_vec=1, beta_vec_4way=beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{tau_vec<-array(1, dim=length(tau_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
print(range_4ways)
print(X[,range_4ways])
four_ways_contrib<-(X[,range_4ways]%*%as.vector(beta_vec_4way))*tau_vec ##last multiplication should be elementwise
return(four_ways_contrib)}
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X=X, tau_vec=1, beta_vec_4way=beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
four_ways_contribution<-function(X, tau_vec, beta_vec_4way,l1=21,l2=14,l3=2,l4=3, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
{if (already_multiplied==TRUE)
{tau_vec<-array(1, dim=length(tau_vec))}
range_4ways<-unlist(get_ranges4(l1,l2,l3,l4)[4])
print(range_4ways)
print(X[,range_4ways])
four_ways_contrib<-(X[,range_4ways]%*%matrix(beta_vec_4way, ncol = 1))*tau_vec ##last multiplication should be elementwise
return(four_ways_contrib)}
beta_vec_4way<-get_beta_vec_4way4(beta_vec_3way, tau=1, l1=1, l2=1, l3=1, l4=1)
four_ways_contribution(X=X, tau_vec=1, beta_vec_4way=beta_vec_4way,l1=1,l2=1,l3=1,l4=1, already_multiplied=FALSE) ##assumes gamma_vec is in same order as X and beta_vec_3way only prod of beta2way
matrix(beta_vec_4way, ncol = 1))
X[,15]%*%beta_vec_4way
X[,15]%*%matrix(beta_vec_4way, ncol = 1)
g_bern(X, beta=c(beta_main, beta_2way, beta_vec_3way, beta_vec_4way),
gamma_vec=beta_2way, delta_vec=beta_vec_3way, tau_vec=beta_vec_4way, l1=1,l2=1,l3=1,l4=1, already_multiplied=TRUE)
g_bern<-function(X, beta, gamma_vec, delta_vec, tau_vec, l1=21,l2=14,l3=2,l4=3, already_multiplied=TRUE) #bet_2way is without gamma, beta_3way without delta only
#already multiplied=True means beta already has gamma delta inside
{beta_main<-beta[unlist(get_ranges(l1,l2,l3,l4)[1])]
beta_2way<-beta[unlist(get_ranges(l1,l2,l3,l4)[2])]
beta_3way<-beta[unlist(get_ranges(l1,l2,l3,l4)[3])]
beta_4way<-beta[unlist(get_ranges4(l1,l2,l3,l4)[4])]
if (already_multiplied==TRUE)
{gamma_vec<-array(1, dim=length(gamma_vec))
delta_vec<-array(1, dim=length(delta_vec))
tau_vec<-array(1, dim=length(tau_vec))}
v<-mains_contribution(X=X, beta_main = beta_main, l1=l1, l2=l2, l3=l3)+
two_ways_contribution(X=X, gamma_vec=gamma_vec, beta_vec_2way=beta_2way,l1=l1, l2=l2, l3=l3, already_multiplied = FALSE)+
three_ways_contribution(X=X, delta_vec = delta_vec, beta_vec_3way = beta_3way,l1=l1, l2=l2, l3=l3, already_multiplied = FALSE)+
four_ways_contribution<-function(X=X, tau_vec=tau_vec, beta_vec_4way=beta_4way,l1=l1,l2=l2,l3=l3,l4=l4, already_multiplied=FALSE)
result<-kappa1(v)
#cat("g:", result[1:10])
return(result)
}
g_bern(X, beta=c(beta_main, beta_2way, beta_vec_3way, beta_vec_4way),
gamma_vec=beta_2way, delta_vec=beta_vec_3way, tau_vec=beta_vec_4way, l1=1,l2=1,l3=1,l4=1, already_multiplied=TRUE)
g_bern<-function(X, beta, gamma_vec, delta_vec, tau_vec, l1=21,l2=14,l3=2,l4=3, already_multiplied=TRUE) #bet_2way is without gamma, beta_3way without delta only
#already multiplied=True means beta already has gamma delta inside
{beta_main<-beta[unlist(get_ranges4(l1,l2,l3,l4)[1])]
beta_2way<-beta[unlist(get_ranges4(l1,l2,l3,l4)[2])]
beta_3way<-beta[unlist(get_ranges4(l1,l2,l3,l4)[3])]
beta_4way<-beta[unlist(get_ranges4(l1,l2,l3,l4)[4])]
if (already_multiplied==TRUE)
{gamma_vec<-array(1, dim=length(gamma_vec))
delta_vec<-array(1, dim=length(delta_vec))
tau_vec<-array(1, dim=length(tau_vec))}
v<-mains_contribution(X=X, beta_main = beta_main, l1=l1, l2=l2, l3=l3)+
two_ways_contribution(X=X, gamma_vec=gamma_vec, beta_vec_2way=beta_2way,l1=l1, l2=l2, l3=l3, already_multiplied = FALSE)+
three_ways_contribution(X=X, delta_vec = delta_vec, beta_vec_3way = beta_3way,l1=l1, l2=l2, l3=l3, already_multiplied = FALSE)+
four_ways_contribution<-function(X=X, tau_vec=tau_vec, beta_vec_4way=beta_4way,l1=l1,l2=l2,l3=l3,l4=l4, already_multiplied=FALSE)
result<-kappa1(v)
#cat("g:", result[1:10])
return(result)
}
g_bern(X, beta=c(beta_main, beta_2way, beta_vec_3way, beta_vec_4way),
gamma_vec=beta_2way, delta_vec=beta_vec_3way, tau_vec=beta_vec_4way, l1=1,l2=1,l3=1,l4=1, already_multiplied=TRUE)
g_bern<-function(X, beta, gamma_vec, delta_vec, tau_vec, l1=21,l2=14,l3=2,l4=3, already_multiplied=TRUE) #bet_2way is without gamma, beta_3way without delta only
#already multiplied=True means beta already has gamma delta inside
{beta_main<-beta[unlist(get_ranges4(l1,l2,l3,l4)[1])]
beta_2way<-beta[unlist(get_ranges4(l1,l2,l3,l4)[2])]
beta_3way<-beta[unlist(get_ranges4(l1,l2,l3,l4)[3])]
beta_4way<-beta[unlist(get_ranges4(l1,l2,l3,l4)[4])]
if (already_multiplied==TRUE)
{gamma_vec<-array(1, dim=length(gamma_vec))
delta_vec<-array(1, dim=length(delta_vec))
tau_vec<-array(1, dim=length(tau_vec))}
v<-mains_contribution(X=X, beta_main = beta_main, l1=l1, l2=l2, l3=l3, l4=l4)+
two_ways_contribution(X=X, gamma_vec=gamma_vec, beta_vec_2way=beta_2way,l1=l1, l2=l2, l3=l3, l4=l4, already_multiplied = FALSE)+
three_ways_contribution(X=X, delta_vec = delta_vec, beta_vec_3way = beta_3way,l1=l1, l2=l2, l3=l3, l4=l4, already_multiplied = FALSE)+
four_ways_contribution<-function(X=X, tau_vec=tau_vec, beta_vec_4way=beta_4way,l1=l1,l2=l2,l3=l3,l4=l4, already_multiplied=FALSE)
result<-kappa1(v)
#cat("g:", result[1:10])
return(result)
}
g_bern(X, beta=c(beta_main, beta_2way, beta_vec_3way, beta_vec_4way),
gamma_vec=beta_2way, delta_vec=beta_vec_3way, tau_vec=beta_vec_4way, l1=1,l2=1,l3=1,l4=1, already_multiplied=TRUE)
