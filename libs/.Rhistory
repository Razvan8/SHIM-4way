for (k in range3){
for(l in range4 ){
discard_from_c_3way<-c()
print('inside jkl')
beta_2way <- get_beta_vec_2way4(beta = beta_hat, l1=l1, l2=l2, l3=l3, l4=l4, gamma=gamma_hat, only_beta = FALSE) ###This is with delta
beta_3way <- get_beta_vec_3way4(beta_2way = beta_2way, l1=l1, l2=l2, l3=l3, l4=l4, delta=delta_hat, only_beta = FALSE) #This is with gamma WITH delta
beta_4way <- get_beta_vec_4way4(beta_3way = beta_3way, l1=l1, l2=l2, l3=l3, l4=l4, tau=tau_hat, only_beta = FALSE) #This is  WITH tau
beta_all<-c(beta_hat, beta_2way, beta_3way, beta_4way)
print(length(beta_all))
beta_all<- matrix(beta_all, ncol=1)
eta<-X%*%beta_all + intercept
y_tilde<-y
three_ways=0
#print("ok")
three_ways<-three_ways+ X_3way[,psi_table_position_to_vector_index4(c(j,k,l),l1=l1, l2=l2, l3=l3, l4=l4)]*(beta_hat[j]*beta_hat[k]*beta_hat[l])^2*
gamma_hat[get_position_vec_from_theta_matrix4(c(j,l), l1=l1, l2=l2 ,l3=l3, l4=l4)] *
gamma_hat[get_position_vec_from_theta_matrix4(c(k,l), l1=l1, l2=l2 ,l3=l3, l4=l4)] *
gamma_hat[get_position_vec_from_theta_matrix4(c(j,k), l1=l1, l2=l2 ,l3=l3, l4=l4)]
discard_from_c_3way<-c(discard_from_c_3way,psi_table_position_to_vector_index4(c(j,k,l),l1=l1, l2=l2, l3=l3, l4=l4)) #actually just one
assert(length(discard_from_c_3way ==1), "should discard only one three way in update delta")
#cat("discard fromm C 3 way", discard_from_c_3way, " ;")
discard_from_c_4way<-c()
four_ways=0
for (i in range1)
{four_ways<-four_ways+ X_4way[,phi_table_position_to_vector_index4(c(i,j,k,l),l1=l1, l2=l2, l3=l3, l4=l4)]*(beta_hat[i]*beta_hat[j])^6*
(gamma_hat[get_position_vec_from_theta_matrix4(c(i,k), l1=l1, l2=l2 ,l3=l3, l4=l4)] *
gamma_hat[get_position_vec_from_theta_matrix4(c(i,l), l1=l1, l2=l2 ,l3=l3, l4=l4)] *
gamma_hat[get_position_vec_from_theta_matrix4(c(j,k), l1=l1, l2=l2 ,l3=l3, l4=l4)] *
gamma_hat[get_position_vec_from_theta_matrix4(c(j,l), l1=l1, l2=l2 ,l3=l3, l4=l4)] *
gamma_hat[get_position_vec_from_theta_matrix4(c(k,l), l1=l1, l2=l2 ,l3=l3, l4=l4)]*
gamma_hat[get_position_vec_from_theta_matrix4(c(i,j), l1=l1, l2=l2 ,l3=l3, l4=l4)])^2 *
delta_hat[psi_table_position_to_vector_index4(c(i,j,k), l1=l1, l2=l2, l3=l3, l4=l4)]*
delta_hat[psi_table_position_to_vector_index4(c(i,j,l), l1=l1, l2=l2, l3=l3, l4=l4)]*
delta_hat[psi_table_position_to_vector_index4(c(i,k,l), l1=l1, l2=l2, l3=l3, l4=l4)]*
tau_hat[phi_table_position_to_vector_index4(c(i,j,k,l), l1=l1, l2=l2, l3=l3, l4=l4)]*
(beta_hat[k]*beta_hat[l])^6
discard_from_c_4way<-c(discard_from_c_4way,phi_table_position_to_vector_index4(c(i,j,k,l),l1=l1, l2=l2, l3=l3, l4=l4))
#print("X(beta - decomposed beta for 3way)")
#print(beta_3way[psi_table_position_to_vector_index4(c(i,j,k), l1=l1, l2=l2 ,l3=l3, l4=l4)]-(beta_hat[i]*beta_hat[j]*beta_hat[k])^2*
#gamma_hat[get_position_vec_from_theta_matrix4(c(i,j), l1=l1, l2=l2 ,l3=l3, l4=l4)] *
#gamma_hat[get_position_vec_from_theta_matrix4(c(i,k), l1=l1, l2=l2 ,l3=l3, l4=l4)] *
#gamma_hat[get_position_vec_from_theta_matrix4(c(j,k), l1=l1, l2=l2 ,l3=l3, l4=l4)] *
#delta_hat[psi_table_position_to_vector_index4(c(i,j,k), l1=l1, l2=l2, l3=l3, l4=l4)])
}
#cat("ITER: ", i,j,k, " ;")
X_tilde<- three_ways + four_ways
#C<-eta-X_tilde * gamma_hat[get_position_vec_from_theta_matrix4(c(i,j), l1=l1, l2=l2 ,l3=l3, l4=l4)]
#- Z_tilde*gamma_hat[get_position_vec_from_theta_matrix4(c(i,j), l1=l1, l2=l2 ,l3=l3, l4=l4)]^2
C<- X_main%*%beta_hat+X_2way%*%beta_2way+
+X_3way[,-discard_from_c_3way]%*%beta_3way[-discard_from_c_3way]+  X_4way[,-discard_from_c_4way]%*%beta_4way[-discard_from_c_4way] +intercept
# cat("C1-C:", max(abs(C1-C)), " " , sum(abs(C1-C)), " ")
# if (max(abs(eta-(C+X_tilde*delta_hat[psi_table_position_to_vector_index4(c(i,j,k), l1=l1, l2=l2, l3=l3, l4=l4)]) ))>1e-1){
#cat("eta-C", eta-C, dim(matrix(X_3way[,discard_from_c_3way], ncol=1)) )
#print("max eta-C-X_tilde*delta")
#print(max(abs(eta-(C+X_tilde*delta_hat[psi_table_position_to_vector_index4(c(i,j,k), l1=l1, l2=l2, l3=l3, l4=l4)]) )) )
#print("max eta-C-3ways*delta -4ways*delta")
#print("max beta separated")
#print(max(abs(eta-(C+matrix(X_3way[,discard_from_c_3way], ncol=1)*beta_3way[discard_from_c_3way]+
#               matrix(X_4way[,discard_from_c_4way], nrow=length(eta))%*%beta_4way[discard_from_c_4way] ) ) ) )
#}
Q_old <- Q_bern(X=X,y=y, beta=beta_hat, gamma_vec=gamma_hat, delta_vec=delta_hat, tau_vec=tau_hat,
lambda_beta=0, lambda_gamma=0, lambda_delta=lambda_delta, lambda_tau = 0,
w_beta=1, w_gamma=1, w_delta=1, w_tau=1, l1=l1,l2=l2,l3=l3,l4=l4, already_multiplied=TRUE, intercept = intercept)
#############USE MINIMZER Q_BERN_GAMMA ##################
delta_old_value<-delta_hat[psi_table_position_to_vector_index4(c(j,k,l), l1=l1, l2=l2, l3=l3, l4=l4)]
delta_hat[psi_table_position_to_vector_index4(c(j,k,l), l1=l1, l2=l2, l3=l3, l4=l4)] <- minimizer_Q_bern_delta(
X=X_tilde, y=y_tilde, C=C, lambda=lambda_delta, beta_old = delta_old_value, weight=1, scaled=TRUE) ##intercept is in C
beta_2way <- get_beta_vec_2way4(beta = beta_hat, l1=l1, l2=l2, l3=l3, l4=l4, gamma=gamma_hat, only_beta = FALSE) ###This is with delta
beta_3way <- get_beta_vec_3way4(beta_2way = beta_2way, l1=l1, l2=l2, l3=l3, l4=l4, delta=delta_hat, only_beta = FALSE) #This is with gamma WITH delta
beta_4way <- get_beta_vec_4way4(beta_3way = beta_3way, l1=l1, l2=l2, l3=l3, l4=l4, tau=tau_hat, only_beta = FALSE) #This is  WITH tau
beta_all<-c(beta_hat, beta_2way, beta_3way, beta_4way)
beta_all<- matrix(beta_all, ncol=1)
eta<-X%*%beta_all + intercept
Q_new <-Q_bern(X=X,y=y, beta=beta_hat, gamma_vec=gamma_hat, delta_vec=delta_hat, tau_vec=tau_hat,
lambda_beta=0, lambda_gamma=0, lambda_delta=lambda_delta, lambda_tau = 0,
w_beta=1, w_gamma=1, w_delta=1, w_tau=1, l1=l1,l2=l2,l3=l3,l4=l4, already_multiplied=TRUE, intercept = intercept)
if ( Q_new-Q_old >abs(Q_old)*1e-2){
print("There might be numerical instability in update delta.")
}
if ( Q_new-Q_old >=0){
delta_hat[psi_table_position_to_vector_index4(c(j,k,l), l1=l1, l2=l2, l3=l3, l4=l4)]<-delta_old_value
}
}}}
return(delta_hat)
}
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.9,1.1)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.4,2.1)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.4,2.1)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.4,2.1)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.4,2.1)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.4,2.1)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.4,2.1)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.4,2.1)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.4,2.1)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.4,2.1)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
noise_scale<-runif(length(gamma_true), 0.8,1.4)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.8,1.4)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.8,1.4)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.8,1.4)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.8,1.4)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.8,1.4)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.8,1.7)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.8,1.7)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.8,1.7)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
for (it in range (50))
{ ok=0
improvement_total<-0
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.8,1.4)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
improvement_total<- improvement_total + ( sum(abs(gamma_hat-gamma_true)) - sum(abs(gamma_pred-gamma_true)) )
if (sum(abs(gamma_pred-gamma_true)) < sum(abs(gamma_hat-gamma_true)) )
{ok<-ok+1}
}
print(ok)
for (it in c(1:50))
{ ok=0
improvement_total<-0
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.8,1.4)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
improvement_total<- improvement_total + ( sum(abs(gamma_hat-gamma_true)) - sum(abs(gamma_pred-gamma_true)) )
if (sum(abs(gamma_pred-gamma_true)) < sum(abs(gamma_hat-gamma_true)) )
{ok<-ok+1}
}
print(ok)
print(improvement_total)
ok=0
improvement_total<-0
for (it in c(1:50))
{
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.8,1.4)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
improvement_total<- improvement_total + ( sum(abs(gamma_hat-gamma_true)) - sum(abs(gamma_pred-gamma_true)) )
if (sum(abs(gamma_pred-gamma_true)) < sum(abs(gamma_hat-gamma_true)) )
{ok<-ok+1}
}
print(ok)
print(improvement_total)
ok=0
improvement_total<-0
for (it in c(1:50))
{
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.5,2)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=0, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
improvement_total<- improvement_total + ( sum(abs(gamma_hat-gamma_true)) - sum(abs(gamma_pred-gamma_true)) )
if (sum(abs(gamma_pred-gamma_true)) < sum(abs(gamma_hat-gamma_true)) )
{ok<-ok+1}
}
ok=0
improvement_total<-0
for (it in c(1:50))
{
gamma_hat<-gamma_true
#gamma_hat[1]<-1
noise_scale<-runif(length(gamma_true), 0.5,2)
gamma_hat<-noise_scale*gamma_hat
gamma_pred<-update_gamma(X=X, y=y, beta_hat=beta_main, gamma_hat=gamma_hat, delta_hat=delta_hat, tau_hat = tau_hat,
lambda_gamma=1e-4, l1=l1,l2=l2,l3=l3,l4=l4, w=1, intercept=intercept)
print("gamma before")
print(gamma_hat)
print("gamma_pred")
print(gamma_pred)
print("gamma true")
print(gamma_true)
print('error before')
print(sum(abs(gamma_hat-gamma_true)))
print("error after")
print(sum(abs(gamma_pred-gamma_true)))
improvement_total<- improvement_total + ( sum(abs(gamma_hat-gamma_true)) - sum(abs(gamma_pred-gamma_true)) )
if (sum(abs(gamma_pred-gamma_true)) < sum(abs(gamma_hat-gamma_true)) )
{ok<-ok+1}
}
print(ok)
print(improvement_total)
